{% extends 'sanalberto/base.html' %}
{% load users_tags %}

{% block content %}
  <div class="split">
    <h2>{{ poll.title }}</h2>

    {% if perms.sanalberto.view_poll and perms.sanalberto.view_pollvote %}
      <a class="button alt" href="{% url 'sanalberto:poll_admin' poll.slug %}">Administraci칩n</a>
    {% endif %}
  </div>

  {% if poll.register_enabled %}
    <div class="box wrapper style3 split alert">
      <p>춰El registro de dise침os est치 abierto hasta el {{ poll.register_end | date:'j M Y \a \l\a\s H:i' }}!</p>

      <a class="button special" href="{% url 'sanalberto:design_create' poll.slug %}">Presentar dise침o</a>
    </div>
  {% elif poll.register_start > now %}
    <div class="box wrapper style3 alert">
      <p>El registro de dise침os se abrir치 el {{ poll.register_start | date:'j M Y \a \l\a\s H:i' }}.</p>
    </div>
  {% endif %}

  {% if my_vote %}
    <div class="box wrapper style3 alert">
      <div class="split">
        <h4>Mi voto</h4>

        <p>춰El periodo de votaci칩n est치 abierto hasta el {{ poll.voting_end | date:'j M Y \a \l\a\s H:i' }}!</p>
      </div>

      <div class="split">
        <ol style="margin-bottom: 0;">
          <li>Primera opci칩n: <b>{{ my_vote.first.title }}</b></li>

          {% if my_vote.second %}
            <li>Segunda opci칩n: <b>{{ my_vote.second.title }}</b></li>
          {% endif %}

          {% if my_vote.third %}
            <li>Tercera opci칩n: <b>{{ my_vote.third.title }}</b></li>
          {% endif %}
        </ol>

        <a class="button special" href="{% url 'sanalberto:poll_vote' poll.slug %}">Cambiar voto</a>
      </div>
    </div>
  {% elif poll.voting_enabled %}
    <div class="box wrapper style3 split alert">
      <p>춰El periodo de votaci칩n est치 abierto hasta el {{ poll.voting_end | date:'j M Y \a \l\a\s H:i' }}!</p>

      <a class="button special" href="{% url 'sanalberto:poll_vote' poll.slug %}">춰Votar!</a>
    </div>
  {% elif poll.voting_start > now %}
    <div class="box wrapper style3 alert">
      <p>El periodo de votaci칩n se abrir치 el {{ poll.voting_start | date:'j M Y \a \l\a\s H:i' }}.</p>
    </div>
  {% endif %}

  {% if poll.voting_end < now %}
    <div class="box wrapper style1">
      {% if poll.winner %}
        <h2 style="text-align: center;">Dise침o ganador</h2>

        <div class="design winner">
          <a class="image square"
            style="background-image: url('{{ poll.winner.image.url }}');"
            href="{{ poll.winner.image.url }}"
            target="_blank"></a>

          <h4>{{ poll.winner.title }}</h4>

          <h4>Por: {{ poll.winner.user | nice_name }}</h4>
        </div>
      {% else %}
        <h5>춰El ganador se anunciar치 pr칩ximamente!</h5>
      {% endif %}
    </div>
  {% endif %}

  {% if my_designs %}
    <h3 style="margin: 0;">Mis dise침os</h3>

    <p style="margin-bottom: 1em;"><b>Recuerda:</b> Los dise침os nuevos aparecer치n en la lista una vez sean revisados y aprobados por la comisi칩n.</p>

    <div class="designs my-designs">
      {% for design in my_designs %}
        <div class="item">
          <div class="design">
            <div class="image square" style="background-image: url('{{ design.image.url }}');"></div>

            <h4>{{ design.title }}</h4>

            {% if not design.is_approved %}
              <p>(Pendiente de aprobaci칩n)</p>
            {% else %}
              <p>(Aprobado)</p>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>

    <hr />
  {% endif %}

  <h3>Dise침os</h3>

  <div class="designs">
    {% for design in approved_designs %}
      <div class="item">
        <div class="design">
          <a class="image square"
             style="background-image: url('{{ design.image.url }}');"
             href="{{ design.image.url }}"
             target="_blank"></a>

          <h4>{{ design.title }}</h4>

          {% if poll.voting_enabled %}
            {% if my_vote and design == my_vote.first %}
              <h5>Has votado: primera opci칩n 游볞</h5>
            {% elif my_vote and design == my_vote.second %}
              <h5>Has votado: segunda opci칩n 游볟</h5>
            {% elif my_vote and design == my_vote.third %}
              <h5>Has votado: tercera opci칩n 游볠</h5>
            {% else %}
              <a href="{% url 'sanalberto:poll_vote' poll.slug %}?selected={{ design.id }}"
                 class="button special">춰Votar!</a>
            {% endif %}
          {% endif %}
        </div>
      </div>
    {% empty %}
      <div class="box wrapper style1">
        <p><b>A칰n no se han registrado dise침os.</b></p>
      </div>
    {% endfor %}
  </div>
{% endblock content %}
